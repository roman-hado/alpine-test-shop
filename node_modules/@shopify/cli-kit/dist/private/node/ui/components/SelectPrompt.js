import SelectInput from './SelectInput.js';
import Table from './Table.js';
import { handleCtrlC } from '../../ui.js';
import React, { useCallback, useState } from 'react';
import { Box, measureElement, Text, useApp, useInput, useStdout } from 'ink';
import { figures } from 'listr2';
import ansiEscapes from 'ansi-escapes';
function SelectPrompt({ message, choices, infoTable, onSubmit, }) {
    const [answer, setAnswer] = useState(choices[0]);
    const { exit: unmountInk } = useApp();
    const [submitted, setSubmitted] = useState(false);
    const { stdout } = useStdout();
    const [height, setHeight] = useState(0);
    const measuredRef = useCallback((node) => {
        if (node !== null) {
            const { height } = measureElement(node);
            setHeight(height);
        }
    }, []);
    useInput(useCallback((input, key) => {
        handleCtrlC(input, key);
        if (key.return) {
            if (stdout && height >= stdout.rows) {
                stdout.write(ansiEscapes.clearTerminal);
            }
            setSubmitted(true);
            unmountInk();
            onSubmit(answer.value);
        }
    }, [answer, onSubmit, height]));
    return (React.createElement(Box, { flexDirection: "column", marginBottom: 1, ref: measuredRef },
        React.createElement(Box, null,
            React.createElement(Box, { marginRight: 2 },
                React.createElement(Text, null, "?")),
            React.createElement(Text, null, message)),
        infoTable && !submitted && (React.createElement(Box, { marginLeft: 7 },
            React.createElement(Table, { table: infoTable }))),
        submitted ? (React.createElement(Box, null,
            React.createElement(Box, { marginRight: 2 },
                React.createElement(Text, { color: "cyan" }, figures.tick)),
            React.createElement(Text, { color: "cyan" }, answer.label))) : (React.createElement(SelectInput, { items: choices, onChange: (item) => {
                setAnswer(item);
            } }))));
}
export { SelectPrompt };
//# sourceMappingURL=SelectPrompt.js.map